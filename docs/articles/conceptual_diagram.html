<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Step-by-step illustration of MIMS-unit algorithm • MIMSunit</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/all.min.css" integrity="sha256-PbSmjxuVAzJ6FPvNYsrXygfGhNJYyZ2GktDbkMBqQZg=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/v4-shims.min.css" integrity="sha256-A6jcAdwFD48VMjlI3GDxUd+eCQa7/KWy6G9oe/ovaPA=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Step-by-step illustration of MIMS-unit algorithm">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-38342303-3"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-38342303-3');
</script>
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MIMSunit</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="Unreleased version">0.6.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/MIMSunit.html">Get Started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Algorithm Walkthrough
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/conceptual_diagram.html">Step-by-step illustration</a>
    </li>
    <li>
      <a href="../articles/truncation_threshold.html">Deciding truncation threshold</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Advance Guidance
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/import_data.html">Import Data</a>
    </li>
    <li>
      <a href="../articles/generate_intermediate.html">Generate Intermediate Output</a>
    </li>
    <li>
      <a href="../articles/customize.html">Customize MIMS unit algorithm</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Performances
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/cross_device_consistency.html">Cross device consistency</a>
    </li>
    <li>
      <a href="../articles/edge_cases.html">Performance under edge conditions</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">API References</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mhealthgroup/mimsunit">
    <span class="fa fa-lg fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Step-by-step illustration of MIMS-unit algorithm</h1>
                        <h4 class="author">Qu Tang</h4>
            
            <h4 class="date">Oct 12, 2019</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/mhealthgroup/MIMSunit/blob/master/vignettes/conceptual_diagram.Rmd"><code>vignettes/conceptual_diagram.Rmd</code></a></small>
      <div class="hidden name"><code>conceptual_diagram.Rmd</code></div>

    </div>

    
    
<p>Here we demonstrate the scripts used to reproduce the diagram.</p>
<div id="origial-data" class="section level3">
<h3 class="hasAnchor">
<a href="#origial-data" class="anchor"></a>Origial data</h3>
<p>We use a one-second segment of raw accelerometer signal (80 Hz, 8g) from a random subject doing jumping jack as test data. The other signals with different sampling rates and dynamic ranges are simulated via the <code>simulated_new_data</code> function. The step-by-step illustration has been presented as Figure 1 in the manuscript.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1">df =<span class="st"> </span>MIMSunit<span class="op">::</span>conceptual_diagram_data</a>
<a class="sourceLine" id="cb1-2" title="2">start_time =<span class="st"> </span>df[[<span class="dv">1</span>,<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb1-3" title="3">stop_time =<span class="st"> </span>start_time <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a></code></pre></div>
<div id="illustration-of-the-original-signals" class="section level4">
<h4 class="hasAnchor">
<a href="#illustration-of-the-original-signals" class="anchor"></a>Illustration of the original signals</h4>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">figs =<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(.data<span class="op">$</span>NAME) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="st">  </span>mHealthR<span class="op">::</span><span class="kw">mhealth.clip</span>(<span class="dt">start_time =</span> start_time, <span class="dt">stop_time =</span> stop_time, <span class="dt">file_type =</span> <span class="st">'sensor'</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="st">  </span><span class="kw">group_map</span>(</a>
<a class="sourceLine" id="cb2-5" title="5">    <span class="op">~</span><span class="st"> </span>MIMSunit<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/MIMSunit/man/illustrate_signal.html">illustrate_signal</a></span>(</a>
<a class="sourceLine" id="cb2-6" title="6">      .x,</a>
<a class="sourceLine" id="cb2-7" title="7">      <span class="dt">title =</span> .y,</a>
<a class="sourceLine" id="cb2-8" title="8">      <span class="dt">line_size =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb2-9" title="9">      <span class="dt">point_size =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb2-10" title="10">      <span class="dt">range =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span>.x<span class="op">$</span>GRANGE[<span class="dv">1</span>], .x<span class="op">$</span>GRANGE[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb2-11" title="11">    ) <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">plot.margin =</span> <span class="kw">unit</span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>, <span class="fl">0.01</span>, <span class="fl">-0.2</span>, <span class="fl">-0.2</span>), <span class="st">"line"</span>))</a>
<a class="sourceLine" id="cb2-12" title="12">  )</a>
<a class="sourceLine" id="cb2-13" title="13">gridExtra<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span>(<span class="dt">grobs =</span> figs, <span class="dt">nrow =</span> <span class="dv">1</span>)</a></code></pre></div>
<p><img src="conceptual_diagram_files/figure-html/unnamed-chunk-2-1.png" width="100%"></p>
<ol style="list-style-type: decimal">
<li>Dashed lines represent the dynamic range region. Beyond this line, signals will be maxed out as shown in Device 1-3.</li>
</ol>
</div>
</div>
<div id="interpolation-upsampling-to-100hz" class="section level3">
<h3 class="hasAnchor">
<a href="#interpolation-upsampling-to-100hz" class="anchor"></a>Interpolation: Upsampling to 100Hz</h3>
<p>The second step is to regularize the sampling rates of the signals and upsample the signal to <strong>100 Hz</strong>, because we have shown extrapolation (see next section) works better and more robustly at <strong>100 Hz</strong> than lower sampling rates.</p>
<div id="illustration-of-the-interpolated-signals" class="section level4">
<h4 class="hasAnchor">
<a href="#illustration-of-the-interpolated-signals" class="anchor"></a>Illustration of the interpolated signals</h4>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">figs =<span class="st"> </span>interp_df <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(.data<span class="op">$</span>NAME) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="st">  </span>mHealthR<span class="op">::</span><span class="kw">mhealth.clip</span>(<span class="dt">start_time =</span> start_time,</a>
<a class="sourceLine" id="cb3-4" title="4">                         <span class="dt">stop_time =</span> stop_time,</a>
<a class="sourceLine" id="cb3-5" title="5">                         <span class="dt">file_type =</span> <span class="st">'sensor'</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-6" title="6"><span class="st">  </span><span class="kw">group_map</span>(</a>
<a class="sourceLine" id="cb3-7" title="7">    <span class="op">~</span><span class="st"> </span>MIMSunit<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/MIMSunit/man/illustrate_signal.html">illustrate_signal</a></span>(</a>
<a class="sourceLine" id="cb3-8" title="8">      .x,</a>
<a class="sourceLine" id="cb3-9" title="9">      <span class="dt">title =</span> .y[[<span class="dv">1</span>]],</a>
<a class="sourceLine" id="cb3-10" title="10">      <span class="dt">line_size =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb3-11" title="11">      <span class="dt">point_size =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb3-12" title="12">      <span class="dt">range =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span>.x<span class="op">$</span>GRANGE[<span class="dv">1</span>], .x<span class="op">$</span>GRANGE[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb3-13" title="13">    ) <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">plot.margin =</span> <span class="kw">unit</span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>, <span class="fl">0.01</span>, <span class="fl">-0.2</span>, <span class="fl">-0.2</span>), <span class="st">"line"</span>))</a>
<a class="sourceLine" id="cb3-14" title="14">  )</a>
<a class="sourceLine" id="cb3-15" title="15">gridExtra<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span>(<span class="dt">grobs =</span> figs, <span class="dt">nrow =</span> <span class="dv">1</span>)</a></code></pre></div>
<p><img src="conceptual_diagram_files/figure-html/unnamed-chunk-4-1.png" width="100%"></p>
</div>
</div>
<div id="extrapolation-restoring-maxed-out-samples" class="section level3">
<h3 class="hasAnchor">
<a href="#extrapolation-restoring-maxed-out-samples" class="anchor"></a>Extrapolation: Restoring “maxed-out” samples</h3>
<p>The third step is to restore the samples that are maxed out due to low dynamic range for signals of intensive movement. Please check the manuscript for the details of the extrapolation algorithm.</p>
<summary><details><div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">extrapolation =<span class="st"> </span><span class="cf">function</span>(df, name, start_time, stop_time) {</a>
<a class="sourceLine" id="cb4-2" title="2">  markers =<span class="st"> </span>MIMSunit<span class="op">::</span><span class="kw">.extrapolate_mark</span>(<span class="st">"gamma"</span>)(df<span class="op">$</span>HEADER_TIME_STAMP, </a>
<a class="sourceLine" id="cb4-3" title="3">                                                 df<span class="op">$</span>X, <span class="op">-</span>df<span class="op">$</span>GRANGE[<span class="dv">1</span>], </a>
<a class="sourceLine" id="cb4-4" title="4">                                                 df<span class="op">$</span>GRANGE[<span class="dv">1</span>], </a>
<a class="sourceLine" id="cb4-5" title="5">                                                 <span class="fl">0.03</span>)</a>
<a class="sourceLine" id="cb4-6" title="6">  markers_df =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="dt">HEADER_TIME_STAMP =</span> df<span class="op">$</span>HEADER_TIME_STAMP,</a>
<a class="sourceLine" id="cb4-7" title="7">                          <span class="dt">X =</span> <span class="kw"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(markers))</a>
<a class="sourceLine" id="cb4-8" title="8">  neighbors =<span class="st"> </span>MIMSunit<span class="op">::</span><span class="kw">.extrapolate_neighbor</span>(markers, <span class="dv">100</span>, <span class="fl">0.05</span>)</a>
<a class="sourceLine" id="cb4-9" title="9">  <span class="cf">if</span> (<span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(neighbors) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb4-10" title="10">    left_indices =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>()</a>
<a class="sourceLine" id="cb4-11" title="11">    right_indices =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>()</a>
<a class="sourceLine" id="cb4-12" title="12">    mo_indices =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>()</a>
<a class="sourceLine" id="cb4-13" title="13">    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(neighbors)) {</a>
<a class="sourceLine" id="cb4-14" title="14">      left_indices =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(left_indices,</a>
<a class="sourceLine" id="cb4-15" title="15">                       neighbors<span class="op">$</span>left_start[i]<span class="op">:</span>neighbors<span class="op">$</span>left_end[i])</a>
<a class="sourceLine" id="cb4-16" title="16">      right_indices =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(right_indices,</a>
<a class="sourceLine" id="cb4-17" title="17">                        neighbors<span class="op">$</span>right_start[i]<span class="op">:</span>neighbors<span class="op">$</span>right_end[i])</a>
<a class="sourceLine" id="cb4-18" title="18">      mo_indices =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(mo_indices,</a>
<a class="sourceLine" id="cb4-19" title="19">                     neighbors<span class="op">$</span>left_end[i]<span class="op">:</span>neighbors<span class="op">$</span>right_start[i])</a>
<a class="sourceLine" id="cb4-20" title="20">    }</a>
<a class="sourceLine" id="cb4-21" title="21">    fitted_line_df =<span class="st"> </span>MIMSunit<span class="op">::</span><span class="kw">.extrapolate_fitline</span>(</a>
<a class="sourceLine" id="cb4-22" title="22">      df[[<span class="dv">1</span>]],</a>
<a class="sourceLine" id="cb4-23" title="23">      df[[<span class="dv">2</span>]],</a>
<a class="sourceLine" id="cb4-24" title="24">      neighbors,</a>
<a class="sourceLine" id="cb4-25" title="25">      markers,</a>
<a class="sourceLine" id="cb4-26" title="26">      <span class="fl">0.6</span>,</a>
<a class="sourceLine" id="cb4-27" title="27">      <span class="dv">100</span>,</a>
<a class="sourceLine" id="cb4-28" title="28">      <span class="fl">0.05</span></a>
<a class="sourceLine" id="cb4-29" title="29">    )</a>
<a class="sourceLine" id="cb4-30" title="30">    <span class="kw"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(fitted_line_df) =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'HEADER_TIME_STAMP'</span>, <span class="st">'X'</span>, <span class="st">'type'</span>, <span class="st">'index'</span>)</a>
<a class="sourceLine" id="cb4-31" title="31">    left_neighbors_df =<span class="st"> </span>df[left_indices, ] <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-32" title="32"><span class="st">      </span>mHealthR<span class="op">::</span><span class="kw">mhealth.clip</span>(<span class="dt">start_time =</span> start_time, </a>
<a class="sourceLine" id="cb4-33" title="33">                             <span class="dt">stop_time =</span> stop_time, </a>
<a class="sourceLine" id="cb4-34" title="34">                             <span class="st">"sensor"</span>) <span class="op">%&gt;%</span><span class="st"> </span>data.frame</a>
<a class="sourceLine" id="cb4-35" title="35">    right_neighbors_df =<span class="st"> </span>df[right_indices, ] <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-36" title="36"><span class="st">      </span>mHealthR<span class="op">::</span><span class="kw">mhealth.clip</span>(<span class="dt">start_time =</span> start_time, </a>
<a class="sourceLine" id="cb4-37" title="37">                             <span class="dt">stop_time =</span> stop_time, </a>
<a class="sourceLine" id="cb4-38" title="38">                             <span class="st">"sensor"</span>) <span class="op">%&gt;%</span><span class="st"> </span>data.frame</a>
<a class="sourceLine" id="cb4-39" title="39">    between_neighbor_df =<span class="st"> </span>df[<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span>left_indices, <span class="op">-</span>right_indices), ] <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-40" title="40"><span class="st">      </span>mHealthR<span class="op">::</span><span class="kw">mhealth.clip</span>(<span class="dt">start_time =</span> start_time, </a>
<a class="sourceLine" id="cb4-41" title="41">                             <span class="dt">stop_time =</span> stop_time, </a>
<a class="sourceLine" id="cb4-42" title="42">                             <span class="st">"sensor"</span>)<span class="op">%&gt;%</span><span class="st"> </span>data.frame</a>
<a class="sourceLine" id="cb4-43" title="43">    between_neighbor_without_maxed_out_df =<span class="st"> </span>df[<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span>left_indices, <span class="op">-</span>right_indices, <span class="op">-</span>mo_indices), ] <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-44" title="44"><span class="st">      </span>mHealthR<span class="op">::</span><span class="kw">mhealth.clip</span>(<span class="dt">start_time =</span> start_time, </a>
<a class="sourceLine" id="cb4-45" title="45">                             <span class="dt">stop_time =</span> stop_time, </a>
<a class="sourceLine" id="cb4-46" title="46">                             <span class="st">"sensor"</span>) <span class="op">%&gt;%</span><span class="st"> </span>data.frame</a>
<a class="sourceLine" id="cb4-47" title="47">    maxed_out_df =<span class="st"> </span>df[mo_indices, ] <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-48" title="48"><span class="st">      </span>mHealthR<span class="op">::</span><span class="kw">mhealth.clip</span>(<span class="dt">start_time =</span> start_time, </a>
<a class="sourceLine" id="cb4-49" title="49">                             <span class="dt">stop_time =</span> stop_time, </a>
<a class="sourceLine" id="cb4-50" title="50">                             <span class="st">"sensor"</span>) <span class="op">%&gt;%</span><span class="st"> </span>data.frame</a>
<a class="sourceLine" id="cb4-51" title="51">    maxed_out_df<span class="op">$</span>weight =<span class="st"> </span>markers_df[mo_indices, <span class="st">'value'</span>] <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-52" title="52"><span class="st">      </span>mHealthR<span class="op">::</span><span class="kw">mhealth.clip</span>(<span class="dt">start_time =</span> start_time, </a>
<a class="sourceLine" id="cb4-53" title="53">                             <span class="dt">stop_time =</span> stop_time, </a>
<a class="sourceLine" id="cb4-54" title="54">                             <span class="st">"sensor"</span>)</a>
<a class="sourceLine" id="cb4-55" title="55">    fitted_line_df =<span class="st"> </span>fitted_line_df <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-56" title="56"><span class="st">      </span>mHealthR<span class="op">::</span><span class="kw">mhealth.clip</span>(<span class="dt">start_time =</span> start_time, </a>
<a class="sourceLine" id="cb4-57" title="57">                             <span class="dt">stop_time =</span> stop_time,</a>
<a class="sourceLine" id="cb4-58" title="58">                             <span class="st">"sensor"</span>) <span class="op">%&gt;%</span><span class="st"> </span>data.frame</a>
<a class="sourceLine" id="cb4-59" title="59">    points_ex_df =<span class="st"> </span>fitted_line_df[fitted_line_df<span class="op">$</span>type <span class="op">==</span><span class="st"> 'point'</span>, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>, <span class="dv">2</span>)]</a>
<a class="sourceLine" id="cb4-60" title="60">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb4-61" title="61">    marks_df =<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb4-62" title="62">    left_neighbors_df =<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb4-63" title="63">    right_neighbors_df =<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb4-64" title="64">    maxed_out_df =<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb4-65" title="65">    between_neighbor_df =<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb4-66" title="66">    between_neighbor_without_maxed_out_df =<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb4-67" title="67">    fitted_line_df =<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb4-68" title="68">    points_ex_df =<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb4-69" title="69">  }</a>
<a class="sourceLine" id="cb4-70" title="70">  df =<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-71" title="71"><span class="st">      </span>mHealthR<span class="op">::</span><span class="kw">mhealth.clip</span>(<span class="dt">start_time =</span> start_time, </a>
<a class="sourceLine" id="cb4-72" title="72">                             <span class="dt">stop_time =</span> stop_time, </a>
<a class="sourceLine" id="cb4-73" title="73">                             <span class="st">"sensor"</span>) <span class="op">%&gt;%</span><span class="st"> </span>data.frame</a>
<a class="sourceLine" id="cb4-74" title="74">  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span>(</a>
<a class="sourceLine" id="cb4-75" title="75">    <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</a>
<a class="sourceLine" id="cb4-76" title="76">      <span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(df),</a>
<a class="sourceLine" id="cb4-77" title="77">      between_neighbor_df,</a>
<a class="sourceLine" id="cb4-78" title="78">      left_neighbors_df,</a>
<a class="sourceLine" id="cb4-79" title="79">      right_neighbors_df,</a>
<a class="sourceLine" id="cb4-80" title="80">      maxed_out_df,</a>
<a class="sourceLine" id="cb4-81" title="81">      between_neighbor_without_maxed_out_df,</a>
<a class="sourceLine" id="cb4-82" title="82">      markers_df,</a>
<a class="sourceLine" id="cb4-83" title="83">      fitted_line_df,</a>
<a class="sourceLine" id="cb4-84" title="84">      points_ex_df,</a>
<a class="sourceLine" id="cb4-85" title="85">      name[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb4-86" title="86">    )</a>
<a class="sourceLine" id="cb4-87" title="87">  )</a>
<a class="sourceLine" id="cb4-88" title="88">}</a></code></pre></div>
</details><p></p></summary><div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">extrap_illustration_list =<span class="st"> </span>interp_df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(.data<span class="op">$</span>NAME) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-2" title="2"><span class="st">  </span><span class="kw">group_map</span>( <span class="op">~</span><span class="st"> </span><span class="kw">extrapolation</span>(</a>
<a class="sourceLine" id="cb5-3" title="3">    .x,</a>
<a class="sourceLine" id="cb5-4" title="4">    <span class="dt">name =</span> .y,</a>
<a class="sourceLine" id="cb5-5" title="5">    <span class="dt">start_time =</span> start_time,</a>
<a class="sourceLine" id="cb5-6" title="6">    <span class="dt">stop_time =</span> stop_time</a>
<a class="sourceLine" id="cb5-7" title="7">  ))</a></code></pre></div>
<div id="illustration-of-extrapolation-algorithm" class="section level4">
<h4 class="hasAnchor">
<a href="#illustration-of-extrapolation-algorithm" class="anchor"></a>Illustration of extrapolation algorithm</h4>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">draw_extrapolation =<span class="st"> </span><span class="cf">function</span>(extrap_illustration) {</a>
<a class="sourceLine" id="cb6-2" title="2">  df =<span class="st"> </span>extrap_illustration[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb6-3" title="3">  between_neighbors_df =<span class="st"> </span>extrap_illustration[[<span class="dv">2</span>]]</a>
<a class="sourceLine" id="cb6-4" title="4">  left_neighbors_df =<span class="st"> </span>extrap_illustration[[<span class="dv">3</span>]]</a>
<a class="sourceLine" id="cb6-5" title="5">  right_neighbors_df =<span class="st"> </span>extrap_illustration[[<span class="dv">4</span>]]</a>
<a class="sourceLine" id="cb6-6" title="6">  extrap_points_df =<span class="st"> </span>extrap_illustration[[<span class="dv">9</span>]]</a>
<a class="sourceLine" id="cb6-7" title="7">  fitted_line_df =<span class="st"> </span>extrap_illustration[[<span class="dv">8</span>]]</a>
<a class="sourceLine" id="cb6-8" title="8">  p =<span class="st"> </span>MIMSunit<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/MIMSunit/man/illustrate_extrapolation.html">illustrate_extrapolation</a></span>(</a>
<a class="sourceLine" id="cb6-9" title="9">    <span class="dt">df =</span> df,</a>
<a class="sourceLine" id="cb6-10" title="10">    <span class="dt">between_neighbor_df =</span> between_neighbors_df,</a>
<a class="sourceLine" id="cb6-11" title="11">    <span class="dt">title =</span> extrap_illustration[[<span class="dv">10</span>]],</a>
<a class="sourceLine" id="cb6-12" title="12">    <span class="dt">left_neighbors_df =</span> left_neighbors_df,</a>
<a class="sourceLine" id="cb6-13" title="13">    <span class="dt">right_neighbors_df =</span> right_neighbors_df,</a>
<a class="sourceLine" id="cb6-14" title="14">    <span class="dt">show_neighbors =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb6-15" title="15">    <span class="dt">extrap_points_df =</span> extrap_points_df,</a>
<a class="sourceLine" id="cb6-16" title="16">    <span class="dt">fitted_line_df =</span> fitted_line_df,</a>
<a class="sourceLine" id="cb6-17" title="17">    <span class="dt">show_extrapolated_points_and_lines =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb6-18" title="18">  ) <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">plot.margin =</span> <span class="kw">unit</span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>, <span class="fl">0.01</span>, <span class="fl">-0.2</span>, <span class="fl">-0.2</span>), <span class="st">"line"</span>))</a>
<a class="sourceLine" id="cb6-19" title="19">  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span>(p)</a>
<a class="sourceLine" id="cb6-20" title="20">}</a>
<a class="sourceLine" id="cb6-21" title="21">figs =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(extrap_illustration_list, draw_extrapolation)</a>
<a class="sourceLine" id="cb6-22" title="22">gridExtra<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span>(<span class="dt">grobs =</span> figs, <span class="dt">nrow =</span> <span class="dv">1</span>)</a></code></pre></div>
<p><img src="conceptual_diagram_files/figure-html/unnamed-chunk-7-1.png" width="100%"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://qutang.dev"><img class="img-circle p-3" src="https://d33wubrfki0l68.cloudfront.net/8af2089476f179254b3bc9628e13f7d143acab42/8309e/images/avatar.jpg" height="40"><span> Qu Tang</span></a>, <a href="https://bouve.northeastern.edu/directory/dinesh-john/"><img class="img-circle p-3" src="https://banner2.kisspng.com/20180410/bbw/kisspng-avatar-user-medicine-surgery-patient-avatar-5acc9f7a7cb983.0104600115233596105109.jpg" height="40"><span> Dinesh John</span></a>, <a href="http://www.ccs.neu.edu/home/intille/"><img class="img-circle p-3" src="http://www.ccs.neu.edu/home/intille/intille-headshot-sm2.jpg" height="40"><span> Stephen Intille</span></a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
